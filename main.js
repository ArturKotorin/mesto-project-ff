(()=>{"use strict";var t="5a8c9dc4-49ac-4d0c-a2aa-c4eb25ec5eeb",e="wff-cohort-10";function o(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(res.status))}var n=document.querySelector("#card-template").content;function r(t){t.target.closest(".places__item").remove()}function c(t){t.target.classList.toggle("card__like-button_is-active")}function a(r,c,a,i,u){var p=n.querySelector(".card").cloneNode(!0),s=p.querySelector(".card__like-button"),l=p.querySelector(".card__image"),_=p.querySelector(".card__like-count");if(u===r.owner._id){var d=p.querySelector(".card__delete-button");d.classList.add("card__delete-button_visible"),d.addEventListener("click",(function(n){var a;a=r._id,fetch("https://mesto.nomoreparties.co/v1/".concat(e,"/cards/").concat(a),{method:"DELETE",headers:{authorization:t,"Content-Type":"application/json"}}).then((function(t){return o(t)})),c(n)}))}return r.likes.some((function(t){return t._id===u}))&&s.classList.toggle("card__like-button_is-active"),s.addEventListener("click",(function(n){var c;n.target.classList.contains("card__like-button_is-active")?(c=r._id,fetch("https://mesto.nomoreparties.co/v1/".concat(e,"/cards/likes/").concat(c),{method:"DELETE",headers:{authorization:t,"Content-Type":"application/json"}}).then((function(t){return o(t)}))).then((function(t){_.textContent=t.likes.length,a(n)})):function(n){return fetch("https://mesto.nomoreparties.co/v1/".concat(e,"/cards/likes/").concat(n),{method:"PUT",headers:{authorization:t,"Content-Type":"application/json"}}).then((function(t){return o(t)}))}(r._id).then((function(t){_.textContent=t.likes.length,a(n)}))})),l.addEventListener("click",i),l.src=r.link,l.alt=r.name,p.querySelector(".card__title").textContent=r.name,_.textContent=r.likes.length,p}function i(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",p)}function u(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",p)}function p(t){if("Escape"===t.key){var e=document.querySelector(".popup_is-opened");e&&u(e)}}function s(t,e,o){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(o.inactiveButtonClass)):(e.disabled=!0,e.classList.add(o.inactiveButtonClass))}function l(t,e,o){var n=t.querySelector(".".concat(e.id,"-error"));n.textContent="",n.classList.remove(o.errorClass),e.classList.remove(o.inputErrorClass)}function _(t,e){var o=Array.from(t.querySelectorAll(e.inputSelector)),n=t.querySelector(e.submitButtonSelector);n.classList.remove(e.inactiveButtonClass),n.disabled=!1,o.forEach((function(o){l(t,o,e),o.setCustomValidity("")}))}var d,m=document.querySelector(".places__list"),f=document.querySelector(".popup_type_edit"),v=document.querySelector(".popup_type_new-card"),y=document.querySelector(".profile__title"),h=document.querySelector(".profile__description"),S=document.querySelector(".profile__image"),b=document.querySelector(".popup__input_type_name"),C=document.querySelector(".popup__input_type_description"),q=document.querySelector(".popup_type_image"),g=document.querySelector(".popup__image"),E=document.querySelector(".popup__caption"),L=document.querySelector(".popup__input_type_card-name"),k=document.querySelector(".popup__input_type_url"),x=document.querySelectorAll(".popup"),B=document.querySelector(".profile__edit-button"),T=document.querySelector(".profile__add-button"),A=document.querySelector(".popup__input_type_avatar-url"),j=document.querySelector(".popup_type_edit-avatar");function z(t){var e=t.target.closest(".card"),o=e.querySelector(".card__image"),n=e.querySelector(".card__title").textContent;i(q),g.src=o.src,g.alt=o.alt,E.textContent=n}function w(t,e){e.textContent=t?"Сохранение...":"Сохранить"}Promise.all([fetch("https://mesto.nomoreparties.co/v1/".concat(e,"/cards"),{headers:{authorization:t}}).then((function(t){return o(t)})),("me",fetch("https://mesto.nomoreparties.co/v1/".concat(e,"/users/").concat("me"),{headers:{authorization:t}}).then((function(t){return o(t)})))]).then((function(t){var e=t[0],o=t[1];e.forEach((function(t){var e;e=a(t,r,c,z,o._id),m.append(e)})),y.textContent=o.name,h.textContent=o.about,S.style.backgroundImage="url('".concat(o.avatar,"')")})).catch((function(t){console.log("Ошибка ".concat(t))})),x.forEach((function(t){t.classList.add("popup_is-animated"),t.addEventListener("click",(function(e){e.target.classList.contains("popup__close")&&u(t),e.target===e.currentTarget&&u(t)}))})),B.addEventListener("click",(function(){i(f),b.value=y.textContent,C.value=h.textContent,_(f,{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"})})),f.addEventListener("submit",(function(n){n.preventDefault();var r,c=f.querySelector(".popup__button");w(!0,c),(r={name:b.value,about:C.value},fetch("https://mesto.nomoreparties.co/v1/".concat(e,"/users/").concat("me"),{method:"PATCH",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify(r)}).then((function(t){return o(t)}))).then((function(t){y.textContent=t.name,h.textContent=t.about})).catch((function(t){console.log(t)})).finally((function(){w(!1,c)})),u(f)})),S.addEventListener("click",(function(){i(j),A.value="",_(j,{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"})})),j.addEventListener("submit",(function(n){n.preventDefault();var r,c=j.querySelector(".popup__button");w(!0,c),(r={avatar:A.value},fetch("https://mesto.nomoreparties.co/v1/".concat(e,"/users/me/avatar"),{method:"PATCH",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify(r)}).then((function(t){return o(t)}))).then((function(t){S.style.backgroundImage="url('".concat(t.avatar,"')")})).catch((function(t){console.log(t)})).finally((function(){w(!1,c)})),u(j)})),T.addEventListener("click",(function(){L.value="",k.value="",i(v),_(v,{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"})})),v.addEventListener("submit",(function(n){n.preventDefault();var i,p=v.querySelector(".popup__button");w(!0,p),(i={name:L.value,link:k.value},fetch("https://mesto.nomoreparties.co/v1/".concat(e,"/cards"),{method:"POST",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify(i)}).then((function(t){return o(t)}))).then((function(t){var e;e=a(t,r,c,z,t.owner._id),m.prepend(e),n.target.reset()})).catch((function(t){console.log(t)})).finally((function(){w(!1,p)})),u(v)})),d={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},Array.from(document.querySelectorAll(d.formSelector)).forEach((function(t){!function(t,e){var o=Array.from(t.querySelectorAll(e.inputSelector)),n=t.querySelector(e.submitButtonSelector);s(o,n,e),o.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,o){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?l(t,e,o):function(t,e,o,n){var r=t.querySelector(".".concat(e.id,"-error"));r.textContent=o,r.classList.add(n.errorClass),e.classList.add(n.inputErrorClass)}(t,e,e.validationMessage,o)}(t,r,e),s(o,n,e)}))}))}(t,d)}))})();